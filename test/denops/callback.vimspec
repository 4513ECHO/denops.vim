Describe denops#callback
  Describe #add()
    It adds a callback and return {id}
      let id = denops#callback#add({ -> 0 })
      Assert Equals(type(id), v:t_string)
      call denops#callback#call(id)
    End
  End

  Describe #remove()
    It removes an {id} callback
      let id = denops#callback#add({ -> 0 })
      call denops#callback#remove(id)
      Throws /No callback function/ denops#callback#call(id)
    End
  End

  Describe #call()
    It calls an {id} callback
      let id = denops#callback#add({ name -> printf('Hello %s', name) })
      let ret = denops#callback#call(id, 'World')
      Assert Equals(ret, 'Hello World')
    End

    It removes an {id} callback after call
      let id = denops#callback#add({ name -> printf('Hello %s', name) })
      let ret = denops#callback#call(id, 'World')
      Assert Equals(ret, 'Hello World')
      Throws /No callback function/ denops#callback#call(id, 'Second')
    End
  End

  Describe #clear()
    It clears all callbacks
      let id = denops#callback#add({ name -> printf('Hello %s', name) })
      call denops#callback#clear()
      Throws /No callback function/ denops#callback#call(id, 'World')
    End
  End
End
