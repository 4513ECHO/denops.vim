Describe denops#callback
  Describe #add()
    It adds a callback and return {id}
      let id = denops#callback#add({ -> 0 })
      Assert Equals(type(id), v:t_string)
      call denops#callback#call(id)
    End
  End

  Describe #call()
    It calls an {id} callback
      let rs = []
      let id = denops#callback#add({ name -> add(rs, ['Hello', name]) })
      call denops#callback#call(id, 'World')
      Assert Equals(rs, [['Hello', 'World']])
    End

    It removes an {id} callback after call
      let rs = []
      let id = denops#callback#add({ name -> add(rs, ['Hello', name]) })
      call denops#callback#call(id, 'World')
      Assert Equals(rs, [['Hello', 'World']])
      Throws /No callback function/ denops#callback#call(id, 'Second')
    End
  End

  Describe #clear()
    It clears all callbacks
      let rs = []
      let id = denops#callback#add({ name -> add(rs, ['Hello', name]) })
      call denops#callback#clear()
      Throws /No callback function/ denops#callback#call(id, 'Second')
    End
  End
End
